# IsatData Pro Orchestrators

The intent of this set of functions is to:

1. Manage the flow of remote commands between a device twin in IoT Hub/Central
and the IoT device/gateway connected remotely via satellite messaging (*non-IP*).
2. Facilitate web app administrative operations to visualize and update the 
IsatDataPro database, in particular adding *Mailbox* accounts.

## Device Twin / Command Proxy IP-to-IDP

* Depends on **device-bridge** function app to provide proxy message definitions 
as writable properties on a device.
* Depends on **satellite-messaging** function app to pick up and generate OTA 
message related Eventgrid events.
* IoT Central can be used to set a writable property value or trigger a proxy 
command defined in a device model, which maps to an IDP forward message.
* An Eventgrid `CommandRequest` triggers the **OtaCommandStart** workflow which 
instantiates the **OtaCommandOrchestrator** function chain / monitor pattern.
* **OtaCommandSubmit** is the first in the chain which publishes an Eventgrid  
`NewForwardSubmission` event and returns a unique submission ID to the 
orchestrator.
* `NewForwardMessage` event is generated by the satellite messaging function app 
and triggers **OtaCommandSending** to correlate the satellite network-assigned 
message ID to the submission ID in the orchestrator.
* **OtaCommandDelivery** is triggered by `ForwardMessageStateChange` to confirm 
delivery or failure of the forward message to the orchestrator.
* The orchestrator then checks if any *completion* is defined in the 
`CommandRequest` it will await a trigger from **OtaCommandResponse** to 
generate an `OtaCommandResponse` event to be picked up by *device-brige* and 
update the relevant proxy command state.

## Administrative Operations for IsatDataPro Database

>: **Note** not yet implemented.